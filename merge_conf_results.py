# Brady Madden
# This script merges the results generated by ConferenceScraper.py into the main data set: ncaa_tournament_data.csv
# Will add two columns: Regular Season Champ and Conference Tournament Champ and populate in binary

import csv

newfile = open('data/ncaa_tournament_data_new.csv', 'a', newline="")
wr = csv.writer(newfile)
# Write headers - including new headers
wr.writerow(['team_name', 'season', 'seed', 'wins', 'losses', 'sos', 'points_for', 'points_against',
             'AP_preseason', 'fg_pct', '3pt_pct', 'ft_pct', 'opp_fg_pct', 'opp_3pt_pct',
             'opp_ft_pct', 'O_reb', 'D_reb', 'opp_O_reb', 'opp_D_reb', 'turnover',
             'opp_turnover', 'ppg', 'opp_ppg', 'reg_season_champ', 'postseason_champ', 'OUTCOME'])
RS_files = ['data/2011_regular_season_champions.csv', 'data/2012_regular_season_champions.csv',
            'data/2013_regular_season_champions.csv', 'data/2014_regular_season_champions.csv',
            'data/2015_regular_season_champions.csv', 'data/2016_regular_season_champions.csv']
PS_files = ['data/2011_postseason_champions.csv', 'data/2012_postseason_champions.csv',
            'data/2013_postseason_champions.csv', 'data/2014_postseason_champions.csv',
            'data/2015_postseason_champions.csv', 'data/2016_postseason_champions.csv']
RS_list = []
PS_list = []
# Create 2D array of RS and PS champions by year to easily search against main data set CSV
for f in RS_files:
    with open(f, 'r') as file:
        innerList = []
        for each in file:
            innerList.append(each.rstrip('\n'))
    RS_list.append(innerList)
for f in PS_files:
    with open(f, 'r') as file:
        innerList = []
        for each in file:
            innerList.append(each.rstrip('\n'))
    PS_list.append(innerList)

with open('data/ncaa_tournament_data.csv', 'r') as f:
    # Skip header line in CSV
    mainlist = iter(csv.reader(f))
    next(mainlist)
    # Iterate over each line in master table
    for line in mainlist:
        year = int(line[1][:4]) + 1
        yearindex = year - 2011
        reg_champ = 0
        post_champ = 0
        for each in RS_list[yearindex]:
            if each == line[0]:
                # Current line in master table is regular season champion
                reg_champ = 1
                break
        for each in PS_list[yearindex]:
            if each == line[0]:
                # Current line in master table is postseason champion
                post_champ = 1
                break
        line.insert(-1, reg_champ)
        line.insert(-1, post_champ)
        with open('data/ncaa_tournament_data_new.csv', 'a', newline="") as z:
            wr.writerow(line)
